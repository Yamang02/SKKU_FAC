# 개발용 Dockerfile

FROM node:22.13.0-alpine

WORKDIR /app

# 권한 문제 방지용 사용자 추가
RUN addgroup -g 1001 -S nodejs && \
    adduser -S gallery -u 1001

# package 파일 복사
COPY package*.json ./

# devDependencies 포함 전체 설치 및 nodemon 글로벌 설치
RUN npm install && \
    npm install -g nodemon && \
    npm cache clean --force

# app 디렉토리 및 권한 설정
RUN mkdir -p /app/logs /app/public/uploads && \
    chown -R gallery:nodejs /app

USER gallery

# 소스 코드 복사 및 권한 설정
COPY --chown=gallery:nodejs . .

ENV NODE_ENV=development
ENV PORT=3000

EXPOSE 3000

# npx를 사용하여 nodemon 실행
CMD ["npx", "nodemon", "./src/server.js"]
